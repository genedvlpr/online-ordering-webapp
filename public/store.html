<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Store</title>

    <link rel="stylesheet" href="css/index.css">

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="red" content="#5a1720">
    <!-- Angular Material style sheet -->
    <link rel="stylesheet" href="css/angular-material.min.css">

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">

      <style>
        body{ 
          background-size: cover;
          background-repeat: no-repeat;
          background-color: #fafafa;
          background-attachment:scroll; 
          align-content: center;
        }
      </style>
  
    </head>
      <body id="body" ng-app="NewApp" ng-cloak ng-controller="AppCtrl">
        <!--
          Your HTML content here
        -->  
        
        <!-- Angular Material requires Angular.js Libraries -->
        <script src="js/angular.min.js"></script>
        <script src="js/angular-animate.min.js"></script>
        <script src="js/angular-aria.min.js"></script>
        <script src="js/angular-messages.min.js"></script>
      
        <!-- Angular Material Library -->
        <script src="js/angular-material.min.js"></script>
        
        <md-content id="content" style="background-color: transparent;">
            <md-toolbar class="md-whiteframe-2dp" id="toolbar" style="   top:0%; background-color: #F5F5F5;color:#304FFE">
                <div class="md-toolbar-tools" >
                     
              
                    <div flex md-truncate >
                        <img src="./src/ic_logo_new.png" style="width: 120px;height:45px;"> 
                      </div>
              
                      <md-button hide-xs hide-sm class="" id="btn_show_items" style="background-color: #F5F5F5; display: none;"></md-button>
                      <li style="display: none;" ng-repeat="x in cartItems"></li>
                      <div layout="row" layout-align="center center" style="height: 100%;padding-right: 20px;">
                        <md-button  class="md-icon-button"   ng-click="toggleLeft()">
                                      <md-icon >
                                        <svg style="width:24px;height:24px" viewBox="0 0 24 24">
                                            <path fill="#FF6F00" d="M17,18A2,2 0 0,1 19,20A2,2 0 0,1 17,22C15.89,22 15,21.1 15,20C15,18.89 15.89,18 17,18M1,2H4.27L5.21,4H20A1,1 0 0,1 21,5C21,5.17 20.95,5.34 20.88,5.5L17.3,11.97C16.96,12.58 16.3,13 15.55,13H8.1L7.2,14.63L7.17,14.75A0.25,0.25 0 0,0 7.42,15H19V17H7C5.89,17 5,16.1 5,15C5,14.65 5.09,14.32 5.24,14.04L6.6,11.59L3,4H1V2M7,18A2,2 0 0,1 9,20A2,2 0 0,1 7,22C5.89,22 5,21.1 5,20C5,18.89 5.89,18 7,18M16,11L18.78,6H6.14L8.5,11H16Z" />
                                        </svg>
                                      </md-icon>
                                    </md-button>
                        <h4 class="md-subhead" id="cart_item_count" style="margin-left:-5px;color: #FF6F00;"></h4>
                          
                      </div>
                      
                      <md-button onclick="goToAccount()" hide-md hide-lg id="btn-save-phone" class="md-icon-button" style=" background-color: #ECEFF1;" >
                        <md-icon md-svg-icon="/src/account-circle.svg"> </md-icon>
                      </md-button> 
                      <md-button class="acc-btn" onclick="goToAccount()"  hide-xs hide-sm class="" id="acc_btn" style="background-color: #F5F5F5; " onclick=" ">Account</md-button>
                      <md-button href="./about.html"  hide-xs hide-sm class="" id="btn_logout_home" style="background-color: #F5F5F5; " onclick=" ">About</md-button>
                      <md-button href="./terms-conditions.html"  hide-xs hide-sm class="" id="btn_logout_home" style="background-color: #F5F5F5; " onclick=" ">Terms & Condition</md-button>
                      <md-button href="./privacy-policy.html"  hide-xs hide-sm class="" id="btn_logout_home" style="background-color: #F5F5F5; " onclick=" ">Privacy Policy</md-button>
                </div>
            </md-toolbar>
      
            <div ng-controller="AppCtrl" layout="row"  ng-cloak style="background-color: #FAFAFA; ">
         
              <md-sidenav md-component-id="left" layout="row" 
            class="md-sidenav-left" md-component-id="left"  md-whiteframe="8"
                              style="background-color: #3D5AFE; height: auto;">
             
            
                  <md-content layout-margin=""  style="background-color: #3D5AFE;color: #fff;">
                    <div layout="row" layout-align="start center">
                        <md-button ng-click="toggleLeft()" class="md-icon-button" style="background-color: transparent;" >
                            <md-icon md-svg-icon="/src/arrow-left.svg" style="color: #fafafa;"> </md-icon>
                        </md-button> 
                        <h4 id="category-header">Cart</h4>
                    </div>
                    
                    <div style="margin-left: 0px;" layout-lg="column" layout-md="column" layout-sm="column" layout-xs="column" layout-align-xs="center center" layout-align-sm="center center" layout-wrap> 
                      <md-card ng-repeat="x in cartItems"  layout="row"  ng-hide='x.itemName  == null'>
                        <div>
                          
                          <label ng-model="x.itemID" style="position: absolute;margin-top: 10px;visibility: hidden;"> {{ x.itemID }}</label>
                          <label ng-model="x.itemDesc" style="position: absolute;margin-top: 10px;visibility: hidden;"> {{ x.itemDesc }}</label>
                        <img ng-model="x.itemImg" src="{{x.itemImg}}" style="width:50px;height:50px;background-color: #82B1FF;" alt="image">
                        </div>
                          
                        <div style="margin-bottom: 20px; margin-left: 20px; margin-right: 20px ;margin-top: 20px;" layout="column">
                        

                          <div layout="row">
                              <h3 ng-model="x.itemName" style="margin: 0px;margin-top: 0px;"  class="md-title" flex id="div-list-item-header" >{{ x.itemName }}</h3> 
                              <md-button ng-click="removeFromCart(x)" class="md-icon-button md-raised" style="background-color: #fafafa;margin-top: -10px;" >
                                <md-icon md-svg-icon="/src/close.svg" style="color: #FF6F00;"> </md-icon>
                              </md-button> 
                          </div>
                          
                          <div layout="row" layout-align="center center" style="margin-top: -10px;" >
                            <div layout="row" layout-align="center center">
                                <h4 class="md-body-2" style="vertical-align: middle;margin-right: 4px;color: #FF6F00">PHP</h4>
                                <h4 ng-model="x.itemPrice" id="price_{{$index}}" class="md-body-2"  style="color: #FF6F00;"   >{{ x.itemPrice }}</h4> 
                                <h4  class="md-body-2" id="origPrice_{{$index}}" style="color: #FF6F00;display: none;"  >{{ x.itemPrice }}</h4>  
                                <h4 class="md-body-2" style="vertical-align: middle;margin-right: 4px;color: #FF6F00;">.00</h4>
                            </div>  
                            <div layout="row" layout-align="center center"  style="margin-top: 0px;" >
                              <md-button ng-click="subQuantity($index)"  class="md-icon-button"  style="margin-top: 0px;margin-left: 0px;" >
                                  <md-icon md-svg-icon="/src/chevron_left.svg"> </md-icon>
                              </md-button> 
                              <input ng-model="x.itemCount"  id="quantity_{{$index}}" class="md-body-2" value="" style="margin-top: 0px;width:20px;border: #fff;
                              text-align: center; color: #78909C;background-color: transparent;"  id="itemCount"  >
                              <md-button ng-click="addQuantity($index)" class="md-icon-button"  style="margin-top: 0px;"  >
                                  <md-icon md-svg-icon="/src/chevron_right.svg"> </md-icon>
                              </md-button> 
                            </div>
                        
                          </div>
                           
                             
                          <div layout="column" style="margin-top: -10px;">
                            <div layout="row" layout-align="start center">
                                <md-icon md-svg-icon="/src/today.svg" style="width: 18px;height: 18px;color: #2979FF;"></md-icon>
                                <h4 ng-model="x.dateAdded" class="md-subhead" flex  style="margin: 0px;margin-top: 0px;font-size: 10px;margin-left: 10px;color: #2979FF;"  id="div-list-item-subhead" >{{ x.dateAdded }}</h4>
                                
                            </div>
                            <div layout="row" layout-align="start center" style="margin-top: 10px;">
                                <md-icon md-svg-icon="/src/local_shipping.svg"  style="width: 18px;height: 18px;color: #00E676;"></md-icon>
                                <h4 ng-model="x.dateDelivery" class="md-subhead" flex  style="margin: 0px;margin-top: 0px;font-size: 10px;margin-left: 10px;color: #00E676;"  id="div-list-item-subhead" >{{ x.dateDelivery }}</h4>
                                
                            </div>
                            
                            
                          </div>
                        
                          <md-card-actions layout="row" layout-align="center center" style="margin: 0px;margin-top: 10px;">
                          
                            <md-button ng-click="addToOrders($index,x)" class="raised md-block" flex style="background-color: #E3F2FD; color: #1A237E;margin: 0px;" >
                                Check Out
                            </md-button> 
                        </md-card-actions> 
                        </div>
                          
                      </md-card>  
                    </div>   

                    <div layout="row"  style="display: none;">
                      <md-input-container class="md-block" flex style="width: auto;">
                        <label>Full name</label>
                        <input id="first_name" value=" " style="width: 250px;" disabled="true">
                      </md-input-container>  
                      <md-input-container class="md-block" flex style="width: auto;">
                          <label>Phone no.</label>
                          <input id="phone" value="09" style="width: 250px;" disabled="true">
                        </md-input-container>

                        <md-input-container class="md-block" flex style="width: auto;">
                          <label>Home</label>
                          <input id="delivery-address" value=" " flex style="width: 100%;" disabled="true">
                        </md-input-container>   
                    </div>
                    
                  </md-content>
            
                </md-sidenav>
              
                  <md-content layout-align="center center" class="md-block" flex style="background-color: transparent; margin-top: 56px;margin-bottom: 56px;min-height: 700px;">
                   
                 
                       
                           <div class='md-padding' layout-align="center center"  layout-lg="row" layout-md="row" layout-sm="column" layout-xs="column"style="align-self: center;">
                            <md-card style="width: 200px;" ng-repeat="x in storeItems" layout="column"  ng-if='x.itemStoreDesc  != null'>
                           
                            <img ng-model="x.itemStoreImg" src="{{x.itemStoreImg}}" style="width:200px;height:200px;background-color: #82B1FF;" alt="image">
                            <div style="margin-bottom: 20px; margin-left: 20px; margin-right: 20px ;margin-top: 20px;" layout="column">
                              <h3 ng-model="x.itemStoreName" class="md-headline" flex style="margin: 0px;margin-top: 0px;"  id="div-list-item-header" >{{ x.itemStoreName }}</h3>
                              <h4 ng-model="x.itemStoreDesc" class="md-subhead" flex  style="margin: 0px;margin-top: 0px;font-size: xx-small;"  id="div-list-item-subhead" >{{ x.itemStoreDesc }}</h4>
                              <div layout="row" layout-align="start center">
                                <h4 class="md-subhead" style="vertical-align: middle;margin-right: 4px;margin-top: 0px;color: #FF6F00;">PHP</h4>
                                <h4 ng-model="x.itemStorePrice" class="md-subhead"  style="margin-top: 0px;color: #FF6F00;"  id="div-list-item-subhead" >{{ x.itemStorePrice }}</h4> 
                                <h4 class="md-subhead" style="vertical-align: middle;margin-right: 4px;color: #FF6F00;margin-top: 0px;">.00</h4>
                              </div> 

                              <md-card-actions layout="row" layout-align="center center" >
                                
                                  <md-button ng-click="addToCart(x)" class="md-icon-button">
                                      <md-icon md-svg-icon="/src/add_to_cart.svg">
      
                                      </md-icon>
                                  </md-button> 
                              </md-card-actions> 
                            </div> 
                          </md-card> 
                          </div> 
                  </md-content>  
              </div>
              
              <div style=" background-color: #304FFE; margin-bottom: 0% " layout-align="center center" layout-xs="column" layoput-sm="column" layout-lg="row"> 

                <div style="padding: 20px; color: #fff" layout-xs="row" layoput-sm="row" layout-lg="column">
                  <md-button href="./store.html" style="width: 200px; text-align: left;text-indent: 20px">Store</md-button> 
                  <md-button href="./index.html" style="width: 200px; text-align: left;text-indent: 20px">Home</md-button> 
                </div>
                <div style="padding: 20px; color: #fff" layout-xs="row" layoput-sm="row" layout-lg="column"> 
                  <md-button href="./about.html" style="width: 200px; text-align: left;text-indent: 20px">About</md-button>
                  <md-button href="./terms-conditions.html" style="width: 200px; text-align: left;text-indent: 20px">Terms & Condition</md-button>  
                </div>
                <div style="padding: 20px; color: #fff" layout-xs="row" layoput-sm="row" layout-lg="column"> 
                  <md-button href="./privacy-policy.html" style="width: 200px; text-align: left;text-indent: 20px">Privacy Policy</md-button> 
                  <md-button href="./login.html" style="width: 200px; text-align: left;text-indent: 20px">Account</md-button> 
                </div>
                <div style="padding: 20px; color: #fff" layout-xs="row" layoput-sm="row" layout-lg="column">  
                  <md-button href="./locations.html" style="width: 200px; text-align: left;text-indent: 20px">Office Location</md-button>
                  <md-button href="./contact-us.html" style="width: 200px; text-align: left;text-indent: 20px">Contact Us</md-button>
                </div>
            </div> 
      </md-content> 
      <script src="https://www.gstatic.com/firebasejs/6.2.3/firebase-app.js"></script>

      <script src="https://www.gstatic.com/firebasejs/6.2.3/firebase-auth.js"></script>
      <script src="https://www.gstatic.com/firebasejs/6.2.3/firebase-firestore.js"></script>

      <script src="js/init-firebase.js"></script>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
      <script src="js/index.js"></script>    
      

      <script>
        function initApp(){
      
        var input_phone = document.getElementById("phone");
        var input_full_name = document.getElementById("first_name");
        var input_address = document.getElementById("delivery-address");

        firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
              // User is signed in.
              var displayName = user.displayName;
              var email = user.email;
              var emailVerified = user.emailVerified;
              var photoURL = user.photoURL;
              var isAnonymous = user.isAnonymous;
              var uid = user.uid;
              var providerData = user.providerData;


              //document.getElementById("googleLogin").disabled = true;
              
                  //document.getElementById("btn_logout").disabled = false;

              if(email == "woodscrapstore@gmail.com"){
                try{
                   
                  setTimeout(function(){
                    window.location.href = "https://wood-scrap.firebaseapp.com/store-admin.html";
                },200);

                   
                }catch(err){
                  console.log("Element: status, not found")
                } 
              } 

              var db = firebase.firestore();

                const docRef = db.doc("users/"+uid+"/account_info/profile");
 

                docRef.get().then(function(doc) {
                    if (doc.exists) {
                        console.log("Document data:", doc.data());
                        db.collection("users").doc(uid).collection("account_info") 
                        .get()
                        .then((querySnapshot) => { 
                            querySnapshot.forEach((doc) => { 
                              const account_info = doc.data();   

                              const full_name = account_info.full_name; 
                              const account_id = account_info.account_id; 
                              const email = account_info.email; 

                              const address = account_info.address; 
                              const phone = account_info.phone; 

                              input_phone.value = phone;
                              input_full_name.value = full_name;
                              input_address.value = address;
                            }
                          )
                        });
                    } else {
                        // doc.data() will be undefined in this case
                        docRef.set({
                          full_name: displayName+"", 
                          email: email+"", 
                          account_id: uid+"", 
                        })
                        .then(function() {
                          console.log("Account Update Successfully.");
                          //document.getElementById("cloudSaveStatus").innerText = "Successful";
                        });

                        console.log("No such document!");
                    }
                }).catch(function(error) {
                    console.log("Error getting document:", error);
                });


               

              // ...
            } else {
              // User is signed out.
              // ...
              
            }
          });
          }
          $(window).load(function(){
            $("#acc_btn").mouseover();
          });

        window.onload = function() {
          
            try{
              initApp();
              
              document.getElementById("btn_logout").disabled = true;
            }catch(err){
              console.log("error initialize.");
            } 
          };
         
        function goToAccount(){
        firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
              // User is signed in.
              var displayName = user.displayName;
              var email = user.email;
              var emailVerified = user.emailVerified;
              var photoURL = user.photoURL;
              var isAnonymous = user.isAnonymous;
              var uid = user.uid;
              var providerData = user.providerData;
 

              if(email != "woodscrapstore@gmail.com"){
                try{ 
                  window.location.href = "https://wood-scrap.firebaseapp.com/account.html"; 
                }catch(err){
                  console.log("Element: status, not found")
                } 
              }

              if(email == "woodscrapstore@gmail.com"){
                try{ 
                  window.location.href = "https://wood-scrap.firebaseapp.com/admin.html"; 
                }catch(err){
                  console.log("Element: status, not found")
                } 
              }
 
            } else {
              window.location.href = "https://wood-scrap.firebaseapp.com/login.html"; 
            }
          });
          }

         function up(max) {
             
             document.getElementById("itemCount").value = parseInt(document.getElementById("itemCount").value) + 1;
             var count_mul_price = parseInt(document.getElementById("itemCount").value);
             document.getElementById("itemPrice").innerText = parseInt(document.getElementById("itemPrice").innerText) + parseInt(document.getElementById("itemOrigPrice").innerText);
             if (document.getElementById("itemCount").value >= parseInt(max)) {
                 document.getElementById("itemCount").value = max;
             }
         }
         function down(min) {
             document.getElementById("itemCount").value = parseInt(document.getElementById("itemCount").value) - 1;
             var count_minus_price = parseInt(document.getElementById("itemCount").value);
             document.getElementById("itemPrice").innerText = parseInt(document.getElementById("itemPrice").innerText) - parseInt(document.getElementById("itemOrigPrice").innerText);
             if (document.getElementById("itemCount").value <= parseInt(min)) {
                 document.getElementById("itemCount").value = min;
                 document.getElementById("itemPrice").innerText = parseInt(document.getElementById("itemOrigPrice").innerText);
             }
         }
      </script>
  </body>
  

</html>
